{"version":3,"sources":["../../../src/services/Categories/categoriesEditService.ts","../../../src/prisma/index.ts","../../../src/utils/validationsServices/validationsCategories.ts"],"sourcesContent":["import prismaClient from \"../../prisma\";\r\nimport { validationsCategoriesService } from \"../../utils/validationsServices/validationsCategories\";\r\nimport { UploadedFile } from \"express-fileupload\";\r\nimport { v2 as cloudinary, UploadApiResponse } from \"cloudinary\";\r\nimport { Messages, MessagesError } from \"../../constants/messages.api\";\r\n\r\ninterface ICategoriesEditService {\r\n  id: string;\r\n  name: string;\r\n  idUserOwner: string;\r\n  label?: string | null;\r\n  icon?: UploadedFile | null;\r\n  themeImageUrl?: UploadedFile | null;\r\n}\r\n\r\nclass CategoriesEditService {\r\n  async execute({\r\n    id,\r\n    idUserOwner,\r\n    name,\r\n    label,\r\n    icon,\r\n    themeImageUrl,\r\n  }: ICategoriesEditService) {\r\n    if (!id) {\r\n      return {\r\n        data: {\r\n          message: \"Não foi possível prosseguir com esta ação, por favor envie o id da categoria para prosseguir.\",\r\n          status: 400,\r\n        },\r\n      };\r\n    }\r\n\r\n    const validationsCategories = validationsCategoriesService({\r\n      idUserOwner,\r\n      name,\r\n      icon,\r\n    });\r\n\r\n    if (validationsCategories) {\r\n      return validationsCategories;\r\n    }\r\n\r\n    const userExists = await prismaClient.users.findFirst({\r\n      where: {\r\n        id: idUserOwner,\r\n      },\r\n    });\r\n\r\n    const categoryExists = await prismaClient.categories.findFirst({\r\n      where: {\r\n        id: id,\r\n      },\r\n    });\r\n\r\n    if (!userExists) {\r\n      return {\r\n        data: {\r\n          message: \"Não foi possível prosseguir com esta ação, o usuário responsável não existe\",\r\n          status: 404,\r\n        }\r\n      };\r\n    }\r\n\r\n    if (!categoryExists) {\r\n      return {\r\n        data: {\r\n         message: \"Não foi possível prosseguir com esta ação, essa categoria não existe\",\r\n         status: 404,\r\n        }\r\n      };\r\n    }\r\n\r\n    try {\r\n      let idIcon = categoryExists.idIcon;\r\n      let idThemeImageUrl = categoryExists.idThemeImageUrl\r\n\r\n\r\n      const resultFile: UploadApiResponse = await new Promise(\r\n        (resolve, reject) => {\r\n          cloudinary.uploader\r\n            .upload_stream(\r\n              {\r\n                public_id: `icons/${idIcon}`,\r\n                overwrite: true,\r\n                folder: \"icons\",\r\n              },\r\n              (err, result) => {\r\n                if (err) {\r\n                  reject(err);\r\n                  return;\r\n                }\r\n\r\n                resolve(result);\r\n              }\r\n            )\r\n            .end(icon.data);\r\n        }\r\n      );\r\n\r\n      const resultThemeImageUrl: UploadApiResponse = await new Promise((resolve) => {\r\n        cloudinary.uploader.upload_stream({\r\n          public_id: `themesCategories/${idThemeImageUrl}`,\r\n          folder: \"themesCategories\"\r\n        }, (err, result) => {\r\n          if(err){\r\n            return {\r\n              data: {\r\n                 message: err,\r\n                 status: 500\r\n              }\r\n            }\r\n          }\r\n          resolve(result)\r\n        }).end(themeImageUrl.data)\r\n      })\r\n\r\n      await prismaClient.categories.update({\r\n        where: {\r\n          id: id,\r\n        },\r\n\r\n        data: {\r\n          name: name,\r\n          label: label,\r\n          icon: resultFile.url ? resultFile.url : null,\r\n          themeImageUrl: resultThemeImageUrl.url ? resultThemeImageUrl.url : null,\r\n        },\r\n      });\r\n\r\n      return {\r\n        data: {\r\n          message: Messages.UpdateMessageSuccess,\r\n          status: 500,\r\n        },\r\n      };\r\n    } catch (err) {\r\n      return {\r\n        data: {\r\n          message: `${MessagesError.UpdateMessageError} ${err}`,\r\n          status: 500,\r\n        },\r\n      };\r\n    }\r\n  }\r\n}\r\n\r\nexport { CategoriesEditService };\r\n","import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prismaClient = new PrismaClient()\r\n\r\nexport default prismaClient;\r\n","import { UploadedFile } from \"express-fileupload\";\r\n\r\ninterface IParamsCategoriesService {\r\n  idUserOwner: string;\r\n  name: string;\r\n  icon?: UploadedFile | null;\r\n}\r\n\r\nexport const validationsCategoriesService = ({\r\n\r\n  name,\r\n  icon,\r\n  idUserOwner,\r\n}: IParamsCategoriesService) => {\r\n  if (!idUserOwner) {\r\n    return {\r\n      data: {\r\n        message:\r\n          \"Não foi possível realizar está ação, informe o id do usuário responsável\", //  (nome, e-mail, senha, cpf, telefone, data de nascimento, residencia, bairro, endereço, cidade e genero)\r\n        status: 400,\r\n      },\r\n    };\r\n  }\r\n \r\n  if (!name) {\r\n    return {\r\n      data: {\r\n        message:\r\n          \"Não foi possível realizar está ação, Preencha o nome da categoria.\", //  (nome, e-mail, senha, cpf, telefone, data de nascimento, residencia, bairro, endereço, cidade e genero)\r\n        status: 400,\r\n      },\r\n    };\r\n  }\r\n\r\n  if (!icon) {\r\n    return {\r\n      data: {\r\n        message:\r\n          \"Não foi possível realizar está ação, por favor envie um icone para prosseguir\", //  (nome, e-mail, senha, cpf, telefone, data de nascimento, residencia, bairro, endereço, cidade e genero)\r\n        status: 400,\r\n      },\r\n    };\r\n  }\r\n};\r\n"],"mappings":"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","names":["cloudinary"]}