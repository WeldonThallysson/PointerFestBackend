{"version":3,"sources":["../../../src/controllers/Users/usersListUsersController.ts","../../../src/utils/desformatter/index.ts","../../../src/utils/formatters/formatterCEP.ts","../../../src/utils/formatters/formatterCPF.ts","../../../src/utils/formatters/formatterDate.ts","../../../src/utils/validators/validatorPermissions.ts","../../../src/prisma/index.ts","../../../src/utils/formatters/formatterCNPJ.ts","../../../src/services/Users/usersGetAllListService.ts"],"sourcesContent":["import { Request, Response } from 'express';\r\nimport { deformatter } from '../../utils/desformatter';\r\nimport { UsersGetAllListService } from '../../services/Users/usersGetAllListService';\r\n \r\nclass UsersGetAllListController {\r\n  async handle(req: Request,res: Response){\r\n    const id_user_logged = req.user_id\r\n    const idOtherUser = req.query.idOtherUser as string\r\n    const name = req.query.name as string\r\n    const companyName = req.query.companyName as string\r\n    const email = req.query.email as string\r\n    const cpfCnpj = req.query.cpfCnpj as string\r\n    const cep = req.query.cep as string\r\n    const phone = req.query.phone as string\r\n    const birthDate = req.query.birthDate as string\r\n    const residence = req.query.residence as string\r\n    const neighborhood = req.query.neighborhood as string\r\n    const address = req.query.address as string\r\n    const city = req.query.city as string;\r\n    const gender = req.query.gender as string;\r\n    const typeAccess = req.query.typeAccess as string; \r\n    const status = req.query.status as string\r\n    \r\n    const getListUsers = new UsersGetAllListService()\r\n    const responseGetListUsers = await getListUsers.execute({\r\n      id_user_logged,\r\n      idOtherUser,\r\n      name,\r\n      companyName: companyName,\r\n      email,\r\n      cpfCnpj: cpfCnpj ? deformatter(cpfCnpj) : null,\r\n      phone: phone ? deformatter(phone) : null,\r\n      birthDate,\r\n      residence,\r\n      neighborhood,\r\n      address,\r\n      city,\r\n      gender,\r\n      typeAccess,\r\n      cep: cep ? deformatter(cep) : null,\r\n      ...(status !== null && {status: status !== 'false' ? true : false})\r\n    })\r\n\r\n    return res.status(responseGetListUsers.data.status).json(responseGetListUsers.data)\r\n\r\n  }\r\n}\r\n\r\nexport { UsersGetAllListController };\r\n","export const deformatter = (item: string) => {\r\n    \r\n    // Remove todos os caracteres não numéricos\r\n    return item.replace(/\\D/g, \"\");\r\n  };\r\n  ","export const formatterCEP = (cep: string) => {\r\n    if(cep){\r\n        const cleanedCEP = cep.replace(/\\D/g, '');\r\n        /*\r\n         if (cleanedCEP.length !== 8) {\r\n            throw new Error('CEP inválido. Deve conter 8 dígitos.');\r\n        }\r\n    \r\n        */\r\n        const formattedCEP = cleanedCEP.replace(/(\\d{5})(\\d{3})/, '$1-$2');\r\n    \r\n        return formattedCEP;\r\n    }\r\n\r\n    return null\r\n   \r\n};","export const formatterCPF = (cpf: string) => {\r\n    const cleanedCPF = cpf.replace(/\\D/g, '');\r\n\r\n\r\n    /*\r\n      if (cleanedCPF.length !== 11) {\r\n        throw new Error('CPF inválido. Deve conter 11 dígitos.');\r\n       }\r\n\r\n    */\r\n\r\n    const formattedCPF = cleanedCPF.replace(/(\\d{3})(\\d)/, '$1.$2') \r\n                                    .replace(/(\\d{3})(\\d)/, '$1.$2') \r\n                                    .replace(/(\\d{3})(\\d{1,2})$/, '$1-$2');\r\n\r\n    return formattedCPF;\r\n};\r\n","import { format, parseISO } from \"date-fns\";\r\n\r\nexport const formatterDate = (date: string) => {\r\n    // Parseia a data no formato ISO\r\n    const formattedBirthDate = parseISO(date);\r\n    return formattedBirthDate; // Retorna o objeto Date\r\n}\r\n\r\nexport const formatterDateToIso = (date: Date | string) => {\r\n    const dateObject = typeof date === \"string\" ? parseISO(date) : date;\r\n    const formattedBirthDate = format(dateObject, \"yyyy-MM-dd\"); \r\n    return formattedBirthDate;\r\n};\r\n\r\nexport const formatterDateToString = (item: string | null) => {\r\n    if (item) {\r\n        // Divide a string de data no formato \"YYYY-MM-DD\"\r\n        const [year, month, day] = item.split('-'); \r\n        // Retorna a data formatada no formato \"DD/MM/YYYY\"\r\n        return `${day}/${month}/${year}`;\r\n    }\r\n    // Retorna null se o item for nulo\r\n    return null; \r\n};\r\n\r\n","import { TypesAccess } from \"../../keys/typeAccess/typesAccess\";\r\n\r\ninterface IValidatorPermissions {\r\n    typeAccess: string,\r\n}\r\n\r\n\r\nexport const validatorPermissions = ({typeAccess}: IValidatorPermissions) => {\r\n  return (typeAccess === TypesAccess.Owner || typeAccess === TypesAccess.Developer || typeAccess === TypesAccess.Master || typeAccess === TypesAccess.Admin)\r\n \r\n}\r\n","import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prismaClient = new PrismaClient()\r\n\r\nexport default prismaClient;\r\n","\r\n\r\n\r\n\r\nexport const formatterCNPJ = (cnpj: string) => {\r\n  const cleanedCNPJ = cnpj.replace(/\\D/g, '');  \r\n\r\n  const formattedCNPJ = cleanedCNPJ.replace(/^(\\d{2})(\\d)/, '$1.$2')\r\n                                   .replace(/^(\\d{2})\\.(\\d{3})(\\d)/, '$1.$2.$3')\r\n                                   .replace(/\\.(\\d{3})(\\d)/, '.$1/$2')\r\n                                   .replace(/(\\d{4})(\\d{2})$/, '$1-$2');\r\n\r\n  return formattedCNPJ;\r\n};\r\n","import { formatterCEP } from \"../../utils/formatters/formatterCEP\";\r\nimport { formatterCPF } from \"../../utils/formatters/formatterCPF\";\r\nimport {\r\n  formatterDate,\r\n  formatterDateToIso,\r\n} from \"../../utils/formatters/formatterDate\";\r\nimport { TypesAccess } from \"../../keys/typeAccess/typesAccess\";\r\nimport { validatorPermissions } from \"../../utils/validators/validatorPermissions\";\r\n\r\nimport prismaClient from \"../../prisma\";\r\nimport { TypePerson } from \"../../keys/typePerson/typePerson\";\r\nimport { formatterCNPJ } from \"../../utils/formatters/formatterCNPJ\";\r\n \r\ninterface IUsersGetAllListService {\r\n  id_user_logged: string;\r\n  idOtherUser: string | null;\r\n  name?: string | null;\r\n  companyName?: string | null;\r\n  email?: string | null;\r\n  cpfCnpj?: string | null;\r\n  phone?: string | null;\r\n  birthDate?: string | null;\r\n  residence?: string | null;\r\n  neighborhood?: string | null;\r\n  address?: string | null;\r\n  city?: string | null;\r\n  gender?: string | null;\r\n  cep?: string | null;\r\n  typeAccess?: string | null;\r\n  masterAccess?: boolean | null;\r\n  status?: boolean;\r\n  page?: number | null;\r\n  limit?: number | null;\r\n}\r\n\r\nclass UsersGetAllListService {\r\n  async execute({\r\n    id_user_logged,\r\n    idOtherUser,\r\n    name,\r\n    companyName,\r\n    email,\r\n    cpfCnpj,\r\n    phone,\r\n    birthDate,\r\n    residence,\r\n    neighborhood,\r\n    address,\r\n    city,\r\n    gender,\r\n    cep,\r\n    typeAccess,\r\n    status,\r\n  }: IUsersGetAllListService) {\r\n    \r\n    const userExistsLogged = await prismaClient.users.findFirst({\r\n      where: { id: id_user_logged },\r\n    });\r\n\r\n    if (!userExistsLogged) {\r\n      return {\r\n        data: {\r\n          message:\r\n            \"Não foi possível realizar a ação, o usuário responsável não foi encontrado.\",\r\n          status: 404,\r\n        },\r\n      };\r\n    }\r\n\r\n    const responseValidation = validatorPermissions({\r\n      typeAccess: userExistsLogged.typeAccess,\r\n    });\r\n\r\n    if (!responseValidation) {\r\n      return {\r\n        data: {\r\n          message: \"Sua conta não possui permissão para realizar esta ação.\",\r\n          status: 403,\r\n        },\r\n      };\r\n    }\r\n\r\n    if (\r\n      (typeAccess && userExistsLogged.typeAccess === TypesAccess.User) ||\r\n      userExistsLogged.typeAccess === TypesAccess.Promoter\r\n    ) {\r\n      return {\r\n        data: {\r\n          message:\r\n            \"Sua conta não possui permissão para buscar pelos parâmetros de tipo do usuário\",\r\n          status: 403,\r\n        },\r\n      };\r\n    }\r\n\r\n    const where: any = { id: { not: id_user_logged } };\r\n\r\n    if (idOtherUser) where.id = { contains: idOtherUser, mode: \"insensitive\" };\r\n    if (name) where.name = { contains: name, mode: \"insensitive\" };\r\n    if (companyName) where.companyName = { contains: companyName, mode: \"insensitive\"}\r\n    if (email) where.email = { contains: email, mode: \"insensitive\" };\r\n    if (cpfCnpj) where.cpfCnpj = { contains: cpfCnpj, mode: \"insensitive\" };\r\n    if (phone) where.phone = { contains: phone };\r\n    if (birthDate) where.birthDate = formatterDate(birthDate);\r\n    if (residence)\r\n      where.residence = { contains: residence, mode: \"insensitive\" };\r\n    if (neighborhood)\r\n      where.neighborhood = { contains: neighborhood, mode: \"insensitive\" };\r\n    if (address) where.address = { contains: address, mode: \"insensitive\" };\r\n    if (cep) where.cep = { contains: cep, mode: \"insensitive\" };\r\n    if (city) where.city = { contains: city, mode: \"insensitive\" };\r\n    if (gender) where.gender = gender;\r\n    if (status !== null) where.status = status;\r\n    if (typeAccess) where.typeAccess = { not: typeAccess, mode: \"insensitive\" };\r\n\r\n    const users = await prismaClient.users.findMany({\r\n      where,\r\n      orderBy: { created_At: \"desc\" },\r\n      select: {\r\n        id: true,\r\n        name: true,\r\n        companyName: true,\r\n        email: true,\r\n        cpfCnpj: true,\r\n        phone: true,\r\n        birthDate: true,\r\n        gender: true,\r\n        city: true,\r\n        street: true,\r\n        neighborhood: true,\r\n        complement: true,\r\n        cep: true,\r\n        number_address: true,\r\n        region_code: true,\r\n        typeAccess: true,\r\n        typePerson:true,\r\n        termsUsePlatform: true,\r\n        termsUseLGPD: true,\r\n        termsPrivacyPolicy: true,\r\n        termsReceiptNews: true,\r\n        \r\n        profileSocialUrl: true,\r\n        profileAvatar: true,\r\n\r\n        registeredBy: true,\r\n        typeAccessRegisteredBy: true,\r\n        cpfRegisteredBy: true,\r\n        dateRegisteredBy: true,\r\n        \r\n        editedBy: true,\r\n        typeAccessEditedBy: true,\r\n        cpfEditedBy: true,\r\n        dateEditedBy: true,\r\n\r\n        tutorialFirstAccess: true,\r\n        status: true,\r\n        created_At: true,\r\n      },\r\n    });\r\n\r\n    const formattedUsers = users.map((user) => ({\r\n      ...user,\r\n      cpfCnpj:\r\n        user.typePerson === TypePerson.Fisic\r\n          ? formatterCPF(user.cpfCnpj)\r\n          : formatterCNPJ(user.cpfCnpj),\r\n      cep: formatterCEP(user.cep),\r\n      birthDate: user.birthDate ? formatterDateToIso(user.birthDate) : null,\r\n    }));\r\n\r\n    return {\r\n      data: {\r\n        items: formattedUsers,\r\n        status: 200,\r\n      },\r\n      status: 200,\r\n    };\r\n  }\r\n}\r\n\r\nexport { UsersGetAllListService };\r\n"],"mappings":"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","names":[]}